<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Helper</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background-color: #f8f9fa; }
        .hidden { display: none; }
        .quiz-card { box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); padding: 20px; border-radius: 10px; }
        .btn-option { width: 100%; margin-bottom: 10px; }
        .nav-pills .nav-link.active { background-color: #007bff; color: white; }
    </style>
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">Math Helper</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('home'); closeMenu()">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('quiz'); closeMenu()">Quiz</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('about'); closeMenu()">About</a></li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Home Page -->
    <div id="home" class="container mt-5">
        <h2 class="text-center fw-bold">Welcome to the Math Challange App!</h2>
        <p class="text-center">Prepare for your Math exams with interactive quizzes.</p>
    </div>

    <!-- Quiz Page -->
    <div id="quiz" class="container mt-5 hidden">
        <h2 class="text-center fw-bold">Math Study Time!</h2>

        <!-- Grade Selection -->
        <div id="grade-selection" class="text-center mt-4">
            <p>Select your grade to get started:</p>
            <select id="grade-select" class="form-select w-50 mx-auto" onchange="saveGrade()">
                <option value="">Select Grade</option>
                <option value="grade3">3rd Grade</option>
                <option value="grade4">4th Grade</option>
                <option value="grade5">5th Grade</option>
                <option value="grade6">6th Grade</option>
            </select>
        </div>

        <!-- Tabs for Grades -->
        <ul class="nav nav-pills mt-4 justify-content-center" id="quiz-tabs">
            <li class="nav-item"><a class="nav-link" id="tab-grade3" href="#" onclick="loadQuiz('grade3')">3rd Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-grade4" href="#" onclick="loadQuiz('grade4')">4th Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-grade5" href="#" onclick="loadQuiz('grade5')">5th Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-grade6" href="#" onclick="loadQuiz('grade6')">6th Grade</a></li>
        </ul>

        <!-- Quiz Questions -->
        <div id="quiz-container" class="quiz-card mt-4 hidden">
            <h3 id="question" class="fw-bold"></h3>
            <div id="options" class="mt-3"></div>
            <button class="btn btn-warning mt-3" onclick="showHint()">Hint</button>
            <button class="btn btn-success mt-3" onclick="showAnswer()">Show Answer</button>
            <p id="hint" class="hidden mt-2 text-secondary"></p>
            <p id="answer" class="hidden mt-2 fw-bold"></p>
            <button class="btn btn-dark mt-3" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <!-- About Page -->
    <div id="about" class="container mt-5 hidden">
        <h2 class="text-center fw-bold">About This App</h2>
        <p class="text-center">This quiz app pulls questions from Google Sheets and helps students prepare for PSSA.</p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let quizData = [];
        let currentQuestionIndex = 0;
        const sheetURLs = {
            "grade3": "Grade3.csv",
            "grade4": "Grade4.csv",
            "grade5": "5Questions.csv",
            "grade6": "Grade6.csv"
        };

        function showPage(page) {
            document.getElementById("home").classList.add("hidden");
            document.getElementById("quiz").classList.add("hidden");
            document.getElementById("about").classList.add("hidden");
            document.getElementById(page).classList.remove("hidden");

            if (page === "quiz") checkSavedGrade();
        }

        function closeMenu() {
            let navbarToggler = document.querySelector(".navbar-toggler");
            let navbarCollapse = document.querySelector(".navbar-collapse");
            if (navbarCollapse.classList.contains("show")) {
                navbarToggler.click();
            }
        }

        function saveGrade() {
            let grade = document.getElementById("grade-select").value;
            if (grade) {
                document.cookie = `selectedGrade=${grade};path=/`;
                loadQuiz(grade);
            }
        }

        function checkSavedGrade() {
            let cookies = document.cookie.split("; ");
            let selectedGrade = cookies.find(row => row.startsWith("selectedGrade="))?.split("=")[1];
            if (selectedGrade) {
                document.getElementById("grade-select").value = selectedGrade;
                loadQuiz(selectedGrade);
            }
        }

        async function loadQuiz(grade) {
            const response = await fetch(sheetURLs[grade]);
            const text = await response.text();
            const rows = text.split("\n").slice(1);
            quizData = rows.map(row => {
                const columns = row.split(",");
                return {
                    question: columns[0],
                    options: [columns[1], columns[2], columns[3], columns[4]],
                    answer: columns[5],
                    hint: columns[6]
                };
            });

            document.getElementById("quiz-container").classList.remove("hidden");
            document.querySelectorAll(".nav-link").forEach(tab => tab.classList.remove("active"));
            document.getElementById(`tab-${grade}`).classList.add("active");

            loadQuestion();
        }

        function loadQuestion() {
            let q = quizData[currentQuestionIndex];
            document.getElementById("question").innerText = q.question;
            document.getElementById("options").innerHTML = q.options.map(option =>
                `<button class="btn btn-primary btn-option" onclick="checkAnswer('${option}')">${option}</button>`
            ).join('');
            document.getElementById("hint").classList.add("hidden");
            document.getElementById("answer").classList.add("hidden");
        }

        function checkAnswer(selected) {
            alert(selected === quizData[currentQuestionIndex].answer.trim() ? "✅ Correct!" : "❌ Wrong! Try again.");
        }

        function showHint() {
            document.getElementById("hint").innerText = quizData[currentQuestionIndex].hint;
            document.getElementById("hint").classList.remove("hidden");
        }

        function showAnswer() {
            document.getElementById("answer").innerText = "Answer: " + quizData[currentQuestionIndex].answer;
            document.getElementById("answer").classList.remove("hidden");
        }

        function nextQuestion() {
            currentQuestionIndex = (currentQuestionIndex + 1) % quizData.length;
            loadQuestion();
        }
    </script>

</body>
</html>
