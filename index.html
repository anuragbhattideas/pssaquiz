<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PSSA Helper</title>

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body { background-color: #f8f9fa; }
        .hidden { display: none; }
        .navbar { box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1); }
        .quiz-card { box-shadow: 0px 4px 8px rgba(0, 0, 0, 0.1); padding: 20px; border-radius: 10px; }
        .btn-option { width: 100%; margin-bottom: 10px; }
        .nav-pills .nav-link.active { background-color: #007bff; color: white; }
    </style>
</head>
<body>

    <!-- Grade Selection Modal -->
    <div id="gradeSelectionModal" class="modal fade" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content p-4">
                <h4 class="text-center fw-bold">Select Your Grade</h4>
                <p class="text-center">We will remember your choice for future visits.</p>
                <div class="text-center">
                    <button class="btn btn-primary m-2" onclick="setUserGrade('3rd')">3rd Grade</button>
                    <button class="btn btn-primary m-2" onclick="setUserGrade('4th')">4th Grade</button>
                    <button class="btn btn-primary m-2" onclick="setUserGrade('5th')">5th Grade</button>
                    <button class="btn btn-primary m-2" onclick="setUserGrade('6th')">6th Grade</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand fw-bold" href="#">PSSA Helper</a>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('home')">Home</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('quiz')">Quiz</a></li>
                <li class="nav-item"><a class="nav-link" href="#" onclick="showPage('about')">About</a></li>
            </ul>
        </div>
    </nav>

    <!-- Home Page -->
    <div id="home" class="container mt-5">
        <h2 class="text-center fw-bold">Welcome to the PSSA Quiz App!</h2>
        <p class="text-center">Prepare for your PSSA exams with interactive quizzes.</p>
    </div>

    <!-- Quiz Page -->
    <div id="quiz" class="container mt-5 hidden">
        <h2 class="text-center fw-bold">PSSA Study Time!</h2>
        <hr>

        <!-- Grade Tabs -->
        <ul class="nav nav-pills justify-content-center mb-4" id="gradeTabs">
            <li class="nav-item"><a class="nav-link" id="tab-3rd" href="#" onclick="loadQuestions('3rd')">3rd Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-4th" href="#" onclick="loadQuestions('4th')">4th Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-5th" href="#" onclick="loadQuestions('5th')">5th Grade</a></li>
            <li class="nav-item"><a class="nav-link" id="tab-6th" href="#" onclick="loadQuestions('6th')">6th Grade</a></li>
        </ul>

        <div class="card quiz-card">
            <h4 id="question" class="fw-semibold"></h4>
            <div id="options" class="mt-3"></div>
            <button class="btn btn-warning mt-3" onclick="showHint()">Hint</button>
            <button class="btn btn-success mt-3" onclick="showAnswer()">Show Answer</button>
            <p id="hint" class="hidden mt-3 text-muted"></p>
            <p id="answer" class="hidden mt-3 fw-bold"></p>
            <button class="btn btn-dark mt-4" onclick="nextQuestion()">Next Question</button>
        </div>
    </div>

    <!-- About Page -->
    <div id="about" class="container mt-5 hidden">
        <h2 class="text-center fw-bold">About This App</h2>
        <p class="text-center">This quiz app pulls questions from Google Sheets and helps students prepare for PSSA.</p>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        let quizData = [];
        let currentQuestionIndex = 0;

        const gradeSheets = {
            "3rd": "YOUR_GOOGLE_SHEET_CSV_URL_3RD",
            "4th": "YOUR_GOOGLE_SHEET_CSV_URL_4TH",
            "5th": "YOUR_GOOGLE_SHEET_CSV_URL_5TH",
            "6th": "YOUR_GOOGLE_SHEET_CSV_URL_6TH"
        };

        function showPage(page) {
            document.getElementById("home").classList.add("hidden");
            document.getElementById("quiz").classList.add("hidden");
            document.getElementById("about").classList.add("hidden");
            document.getElementById(page).classList.remove("hidden");

            if (page === "quiz") {
                let grade = getCookie("preferredGrade");
                if (grade) loadQuestions(grade);
            }
        }

        function getCookie(name) {
            const value = "; " + document.cookie;
            const parts = value.split("; " + name + "=");
            if (parts.length === 2) return parts.pop().split(";").shift();
        }

        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + value + expires + "; path=/";
        }

        function setUserGrade(grade) {
            setCookie("preferredGrade", grade, 30);
            loadQuestions(grade);
            var modal = bootstrap.Modal.getInstance(document.getElementById("gradeSelectionModal"));
            modal.hide();
        }

        async function loadQuestions(grade) {
            document.querySelectorAll('.nav-link').forEach(tab => tab.classList.remove("active"));
            document.getElementById("tab-" + grade).classList.add("active");

            const response = await fetch(gradeSheets[grade]);
            const text = await response.text();
            const rows = text.trim().split("\n").slice(1);

            quizData = rows.map(row => {
                const columns = row.split(",");
                return {
                    question: columns[0],
                    options: [columns[1], columns[2], columns[3], columns[4]],
                    answer: columns[5],
                    hint: columns[6]
                };
            });

            currentQuestionIndex = 0;
            loadQuestion();
        }

        function loadQuestion() {
            const q = quizData[currentQuestionIndex];
            document.getElementById("question").innerText = q.question;
            document.getElementById("options").innerHTML = q.options.map(option =>
                `<button class="btn btn-outline-primary btn-option" onclick="checkAnswer('${option}')">${option}</button>`
            ).join('');
        }

        window.onload = function () {
            let grade = getCookie("preferredGrade");
            if (!grade) new bootstrap.Modal(document.getElementById("gradeSelectionModal")).show();
        };
    </script>

</body>
</html>
